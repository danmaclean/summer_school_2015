---
layout: page
title: Assembling a draft genome in the Galaxy Interface
subtitle: Pre-Processing Sequence Data
minutes: 25
---


> ## Learning Objectives {.objectives}
> * Understanding FASTQ
> * Inspecting and interpreting the quality of sequence data with FASTQC
>

Sequence data is the starting point for most pathogenomics experiments. The raw sequence data will often be assembled into a rough draft assembly before other analysis can be carried out on it. Assembly is a tricky and labour intensive job. The first task is to quality control our sequence reads to ensure that we are working with the best quality data.

During sequencing it is never possible to determine absolutely which base is found at that position in the process, rather the most likely base out of all the options is called. This uncertainty means that a measure of the quality of the call has been developed, the quality score.

> ## {.callout}
> Each base in a sequence read has its own quality score. The actual number of the quality score is generated by a log transformation of the calculated probability of the read being wrong. Quality scores generally fall in the range between 0 (very poor confidence in the base called) and 40 (very high confidence in the base called), though there are some practical complications to this scheme.

All the reads we use are paired-end *FASTQ* reads, in Sanger Quality scaling.
FASTQ format is a multi-line description of the read. The first line starts with a `@` and contains the sequence id. The second line contains the sequence of the read. The third line starts with a `+` and then optionally contains the sequence id again. Line 4 encodes the quality values as weird-looking characters.

~~~
1.  @HWI-EAS396/1
2.  CCTCGGAGTGGAACTGCTGCGCGCTGCGACA
3.  +HWI-EAS396/1
4.  !~@£$%%£$%$%^^@!£$!@£$!@£$@£$@$
~~~

The sequence reads and quality scores are usually output from base callers into `FASTQ` format. The quality scores are provided in a list of characters that encode the score directly. The FASTQ format encodes the base qualities in single characters based on the ASCII code, a computing convention that assigns a unique number to each of the characters used in computing systems, for example the `!` character has the decimal number 33 in the ASCII code (Web Resource: The ASCII Table).

> ## {.callout}
>The FASTQ format is complicated by a number of factors, first the codes must be offset since the first 32 characters of the ASCII set represent non-printable characters like system alerts or beeps and the offset is slightly different depending on the origin of the file. Also the range of numbers that the quality score can fall into differs depending on the provenance of the file, even down to the version of the basecalling pipeline that was used. The difficulties in this popular format and how to deal with them are laid out better elsewhere, but it is important that any user of these technologies is aware of the potential for confusion.

Paired-end reads are those in which the reads actually come in pairs with an approximate distance (in nucleotides) between them. This distance, known as the insert-size, is set during the sample preparation and refers to the size of DNA fragment cut from the gel for sequencing. The `paired-ends` are then sequenced from either side of these fragments and hence if we have paired-end sequences of 75 nts from each end of the DNA fragment with a 350 nt gap between them, our insert-size will be ~500 nts. In this practical we will use two sets of reads with different insert sizes: one set of reads has 500 nt between paired reads and the other has 2000 nt between reads.


> ## Challenge {.challenge}
>
> We will begin by accessing the data to use in the tutorial, it has been pre-loaded into a Galaxy Data Library
>
> +  First, create a new history by going to the History box, clicking on the `Options` dropdown list (it looks like a gear wheel or cog) and selecting `Create New`.
> +  From the Galaxy main page, you will see some menus across the top of the page, the one of which should read `Shared Data`. Hover over this menu item and a drop down list of options should appear, the first of which should read `Data Libraries`, click it.
> +  In the list of Data Libraries you will see one called `Summer School`.
> +  Click on this and you will see a couple of sub-folders. Next to the folder `Assembly` click on the blue arrow-head and check the box next to `left_500_insert.fq`, `right_500_insert.fq`, `left_2000_insert.fq`, `right_2000_insert.fq`.  Make sure `Import to current history` is selected in the box below and click on `Go`. A green bar signalling that your task has been performed successfully will appear at the top of your screen. Click on `Analyze Data` in the menu to return to the main interface.
> +  You will be taken back to your homepage where you should see the four FASTQ files in your history.
> + Check the attributes of the files (pencil icon), they will need to be annotated as `FASTQsanger` format to be used.

Our data is paired-end and therefore contains reads in two files. We want to work with good data, so would like to get rid of sequences where the quality drops too low. The Quality Scores range from 0 to 40, with 0 being very poor and 40 being very good. We have two options, we can entirely throw away a read that contains bases whose quality drops below a threshold or trim the read at the first base that falls below the threshold. We`ll trim the reads with the Sickle Quality Trimmer tool.

> ## Challenge {.challenge}
> +  Click on `NGS:QC and manipulation` in the toolbox. Select `Sickle: Windowed Adaptive Trimming of FastQ data`.
> +  An explanation of the Sickle FASTQ trimmer tool appears in the centre of our Galaxy page. At the top of the page there are dropdown lists of what data we can trim.
> + These are paired-end reads, so set that option.
> + These should also be set to FASTQsanger, so set the quality type appropriately.
> +  Select from the drop down list the reads to trim (e.g. for `Forward Strand Reads` select `left_500_insert.fq`).
> + Set `Don't do 5 trimming` to `No`,
> + Finally set `Quality Threshold` to 20. This action will remove the ends of reads where the average quality score falls below 20. Press execute, the job is queued and then run.
> +  When it finishes, click on the returned dataset name in the history and you will see a summary of the data.
> + Repeat this for both sets of paired reads.


> ## Challenge {.challenge}
>When the history gets quite long, it can get confusing as to which downstream dataset has resulted from which dataset upstream, so we can edit the names of our history items. Lets try it. We`ll start by renaming our trimmed FASTQ data. In each box you will see the dataset number, the dataset name and then 3 symbols - an eye (which displays the data in the central page), a pen (which edits the dataset attributes), and a cross (which deletes the box from the history).
> + In the data item in the history, click on the pen symbol. This will take us to the `Edit Attributes` page. In the `Name:` box remove the current name and type in a suitable name e.g `Trimmed left reads 500 insert `. You can also edit other attributes on this page. Have a look at the various attributes, but don`t change anything. Click `Save`.
> + Note that the name of the dataset has changed but the dataset number has not.
> + Do the same for the other trimmed read history items.


Now we have reads with the correct length and after QC we can view the data graphically to check the quality of the data. We will do this by producing a summary statistics file and then use this to create a boxplot of the distribution of quality scores.

> ## Challenge {.challenge}
> + Under `NGS:QC and manipulation` click on `Compute quality statistics`. The output of the file will contain a number of fields that are explained on the `Compute quality statistics` page. Take some time to look over them. Select the previously filtered FASTQ files and execute.
> + We can now examine the quality of the data by creating a boxplot of the summary statistics output file. Select `Boxplot of quality statistics`.
> + Make sure the `Compute quality statistics` history item is selected in the `Statistics report file:` list and hit Execute.
> +  When the new history item box turns green, view the plot in the central console by clicking on the eye symbol next to the dataset name.
> We can now see the boxplot of quality scores. The  red boxes represent the Inter-quartile range (IQR), with the top and bottom of the red boxes representing the upper and lower quartile values respectively. The solid black line inside the red boxes are the median quality scores, with the upper and lower whiskers representing 1.5 times the value of the IQR. Illumina such as these reads generally have better quality scores at the start which then deteriorate towards the end.
